---
export interface Props {
  variant?: "default" | "compact";
}

const { variant = "default" } = Astro.props;
const newsletterEndpoint = import.meta.env.PUBLIC_NEWSLETTER_EMBED_URL || "";
const newsletterTag = import.meta.env.PUBLIC_NEWSLETTER_TAG || "";
const contactEmail = import.meta.env.PUBLIC_CONTACT_EMAIL || "hello@example.com";
const canSubscribe = newsletterEndpoint.trim().length > 0;
---

<div class={variant === "default" ? "newsletter-box bg-gray-50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-6 my-8" : "newsletter-compact mt-6"}>
  {variant === "default" && (
    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
      New posts, shipping stories, and practical notes straight to your inbox.
    </p>
  )}

  {
    canSubscribe ? (
      <form action={newsletterEndpoint} method="post" target="_blank" class="flex flex-col sm:flex-row gap-3">
        {newsletterTag && <input type="hidden" name="tag" value={newsletterTag} />}
        <input
          type="text"
          name="name"
          placeholder="Your Name"
          class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent"
        />
        <input
          type="email"
          name="email"
          placeholder="Your Email"
          required
          class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent"
        />
        <button
          type="submit"
          class="px-6 py-2 bg-accent rounded-md hover:bg-accent/90 transition-colors font-medium whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2"
          style="color: white;"
        >
          Subscribe
        </button>
      </form>
    ) : (
      <p class="text-sm text-gray-600 dark:text-gray-300">
        Newsletter signup is not configured yet. Reach me at
        <a href={`mailto:${contactEmail}`} class="underline decoration-dashed underline-offset-4 ml-1">{contactEmail}</a>.
      </p>
    )
  }

  {variant === "default" && (
    <p class="text-xs text-gray-500 dark:text-gray-400 mt-3">
      Usually 1-2 emails per month. No spam.
    </p>
  )}
</div>

<style>
  @media (max-width: 640px) {
    .newsletter-box {
      margin-left: -1rem;
      margin-right: -1rem;
      border-radius: 0;
    }
  }
</style>
